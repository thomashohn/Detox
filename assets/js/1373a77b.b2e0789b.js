"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[8887],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=p(n),m=i,h=c["".concat(s,".").concat(m)]||c[m]||d[m]||o;return n?a.createElement(h,r(r({ref:t},u),{},{components:n})):a.createElement(h,r({ref:t},u))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,r[1]=l;for(var p=2;p<o;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},5162:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(7294),i=n(6010);const o="tabItem_Ymn6";function r(e){let{children:t,hidden:n,className:r}=e;return a.createElement("div",{role:"tabpanel",className:(0,i.Z)(o,r),hidden:n},t)}},5488:(e,t,n)=>{n.d(t,{Z:()=>m});var a=n(7462),i=n(7294),o=n(6010),r=n(2389),l=n(7392),s=n(7094),p=n(2466);const u="tabList__CuJ",d="tabItem_LNqP";function c(e){var t;const{lazy:n,block:r,defaultValue:c,values:m,groupId:h,className:g}=e,k=i.Children.map(e.children,(e=>{if((0,i.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),f=m??k.map((e=>{let{props:{value:t,label:n,attributes:a}}=e;return{value:t,label:n,attributes:a}})),v=(0,l.l)(f,((e,t)=>e.value===t.value));if(v.length>0)throw new Error(`Docusaurus error: Duplicate values "${v.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const N=null===c?c:c??(null==(t=k.find((e=>e.props.default)))?void 0:t.props.value)??k[0].props.value;if(null!==N&&!f.some((e=>e.value===N)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${N}" but none of its children has the corresponding value. Available values are: ${f.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:b,setTabGroupChoices:x}=(0,s.U)(),[y,w]=(0,i.useState)(N),C=[],{blockElementScrollPositionUntilNextRender:D}=(0,p.o5)();if(null!=h){const e=b[h];null!=e&&e!==y&&f.some((t=>t.value===e))&&w(e)}const j=e=>{const t=e.currentTarget,n=C.indexOf(t),a=f[n].value;a!==y&&(D(t),w(a),null!=h&&x(h,String(a)))},T=e=>{var t;let n=null;switch(e.key){case"ArrowRight":{const t=C.indexOf(e.currentTarget)+1;n=C[t]??C[0];break}case"ArrowLeft":{const t=C.indexOf(e.currentTarget)-1;n=C[t]??C[C.length-1];break}}null==(t=n)||t.focus()};return i.createElement("div",{className:(0,o.Z)("tabs-container",u)},i.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":r},g)},f.map((e=>{let{value:t,label:n,attributes:r}=e;return i.createElement("li",(0,a.Z)({role:"tab",tabIndex:y===t?0:-1,"aria-selected":y===t,key:t,ref:e=>C.push(e),onKeyDown:T,onFocus:j,onClick:j},r,{className:(0,o.Z)("tabs__item",d,null==r?void 0:r.className,{"tabs__item--active":y===t})}),n??t)}))),n?(0,i.cloneElement)(k.filter((e=>e.props.value===y))[0],{className:"margin-top--md"}):i.createElement("div",{className:"margin-top--md"},k.map(((e,t)=>(0,i.cloneElement)(e,{key:t,hidden:e.props.value!==y})))))}function m(e){const t=(0,r.Z)();return i.createElement(c,(0,a.Z)({key:String(t)},e))}},9157:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>s,default:()=>m,frontMatter:()=>l,metadata:()=>p,toc:()=>d});var a=n(7462),i=(n(7294),n(3905)),o=n(5488),r=n(5162);const l={},s="Migration Guide",p={unversionedId:"guide/migration",id:"guide/migration",title:"Migration Guide",description:"We are improving Detox API as we go along, sometimes these changes require us to break the API in order for it to make more sense. These migration guides refer to breaking changes. If a newer version has no entries in this document, it means it does not require special migration steps. Refer to the release notes of the latter builds to learn about their improvements and changes.",source:"@site/../docs/guide/migration.md",sourceDirName:"guide",slug:"/guide/migration",permalink:"/Detox/docs/next/guide/migration",draft:!1,editUrl:"https://github.com/wix/Detox/edit/next/docs/../docs/guide/migration.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Dealing With Flakiness in Tests",permalink:"/Detox/docs/next/troubleshooting/flakiness"},next:{title:"Contributing",permalink:"/Detox/docs/next/guide/contributing"}},u={},d=[{value:"20.0",id:"200",level:2},{value:"No Mocha support",id:"no-mocha-support",level:3},{value:"Jest 27.2.5 and higher",id:"jest-2725-and-higher",level:3},{value:"<code>testRunner</code> config section",id:"testrunner-config-section",level:3},{value:"Custom Jest environment",id:"custom-jest-environment",level:3},{value:"New Jest config",id:"new-jest-config",level:3},{value:"Stop using timeline artifacts",id:"stop-using-timeline-artifacts",level:3},{value:"Updating command-line scripts",id:"updating-command-line-scripts",level:3},{value:"Revisit environment variables",id:"revisit-environment-variables",level:3},{value:"19.2",id:"192",level:2},{value:"19.0",id:"190",level:2},{value:"Migrating Custom Drivers",id:"migrating-custom-drivers",level:3},{value:"How to migrate",id:"how-to-migrate",level:4},{value:"Troubleshooting",id:"troubleshooting",level:4},{value:"18.6.0",id:"1860",level:2},{value:"18.0",id:"180",level:2},{value:"17.5.2",id:"1752",level:2},{value:"17.4.7",id:"1747",level:2},{value:"<code>jest-cli</code>",id:"jest-cli",level:3},{value:"<code>detox-cli</code>",id:"detox-cli",level:3},{value:"17.3.0",id:"1730",level:2},{value:"17.0.0",id:"1700",level:2},{value:"New API",id:"new-api",level:3},{value:"Modified API (<strong>Potentially Breaking Changes</strong>)",id:"modified-api-potentially-breaking-changes",level:3},{value:"Deprecated API",id:"deprecated-api",level:3},{value:"16.0.0",id:"1600",level:2}],c={toc:d};function m(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"migration-guide"},"Migration Guide"),(0,i.kt)("p",null,"We are improving Detox API as we go along, sometimes these changes require us to break the API in order for it to make more sense. These migration guides refer to breaking changes. If a newer version has no entries in this document, it means it does not require special migration steps. Refer to the release notes of the latter builds to learn about their improvements and changes."),(0,i.kt)("h2",{id:"200"},"20.0"),(0,i.kt)("h3",{id:"no-mocha-support"},"No ",(0,i.kt)("a",{parentName:"h3",href:"https://mochajs.org"},"Mocha")," support"),(0,i.kt)("p",null,"If you were using Mocha, now you have two options:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"switch to ",(0,i.kt)("a",{parentName:"li",href:"https://jestjs.io"},"Jest")," using ",(0,i.kt)("a",{parentName:"li",href:"/Detox/docs/next/cli/init"},(0,i.kt)("inlineCode",{parentName:"a"},"detox init"))," boilerplate as a reference and ",(0,i.kt)("a",{parentName:"li",href:"/Detox/docs/next/config/testRunner"},(0,i.kt)("inlineCode",{parentName:"a"},"testRunner")," config"),";"),(0,i.kt)("li",{parentName:"ul"},"wait until a third-party integration with Mocha appears.")),(0,i.kt)("h3",{id:"jest-2725-and-higher"},"Jest 27.2.5 and higher"),(0,i.kt)("p",null,"You have to upgrade your Jest version to at least 27.2.5 or higher. The recommended choice is 28.x or 29.x."),(0,i.kt)("h3",{id:"testrunner-config-section"},(0,i.kt)("inlineCode",{parentName:"h3"},"testRunner")," config section"),(0,i.kt)("p",null,"Three top-level string properties (",(0,i.kt)("inlineCode",{parentName:"p"},"testRunner"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"runnerConfig"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"specs"),") have been unified into a complex\n",(0,i.kt)("inlineCode",{parentName:"p"},"testRunner")," section which strives to be as agnostic as possible:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-diff",metastring:'title=".detoxrc.js"',title:'".detoxrc.js"'},"-  testRunner: 'jest',\n-  runnerConfig: 'e2e/jest.config.js',\n-  specs: 'e2e',\n-  skipLegacyWorkersInjection: true,\n+  testRunner: {\n+    $0: 'jest',\n+    args: {\n+      config: 'e2e/jest.config.js',\n+      _: ['e2e']\n+    },\n+  },\n")),(0,i.kt)("p",null,"Also, ",(0,i.kt)("inlineCode",{parentName:"p"},"skipLegacyWorkersInjection")," migration option no longer has meaning, so you can remove it safely."),(0,i.kt)("p",null,"If you didn\u2019t have ",(0,i.kt)("inlineCode",{parentName:"p"},"runnerConfig")," previously, use ",(0,i.kt)("inlineCode",{parentName:"p"},"e2e/config.json")," (because that was an implicit default\nin Detox 19 and earlier):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-diff"},"  testRunner: {\n    $0: 'jest',\n    args: {\n+     config: 'e2e/config.json',\n    },\n },\n")),(0,i.kt)("h3",{id:"custom-jest-environment"},"Custom Jest environment"),(0,i.kt)("p",null,"You no longer need to have an autogenerated environment file if you haven\u2019t been customizing it,\nand if it looks like below:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="e2e/environment.js"',title:'"e2e/environment.js"'},"const {\n  DetoxCircusEnvironment,\n  SpecReporter,\n  WorkerAssignReporter,\n} = require('detox/runners/jest-circus');\n\nclass CustomDetoxEnvironment extends DetoxCircusEnvironment {\n  constructor(config, context) {\n    super(config, context);\n\n    // Can be safely removed, if you are content with the default value (=300000ms)\n    this.initTimeout = 300000;\n\n    // This takes care of generating status logs on a per-spec basis. By default, Jest only reports at file-level.\n    // This is strictly optional.\n    this.registerListeners({\n      SpecReporter,\n      WorkerAssignReporter,\n    });\n  }\n}\n\nmodule.exports = CustomDetoxEnvironment;\n")),(0,i.kt)("p",null,"If you want, for example:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"to reduce the init timeout to 120 seconds,"),(0,i.kt)("li",{parentName:"ul"},"remove ",(0,i.kt)("inlineCode",{parentName:"li"},"SpecReporter")," output,"),(0,i.kt)("li",{parentName:"ul"},"remove ",(0,i.kt)("inlineCode",{parentName:"li"},"WorkerAssignReporter")," output,")),(0,i.kt)("p",null,"then you can express this intent via config:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title=".detoxrc.js"',title:'".detoxrc.js"'},"/** @type {Detox.DetoxConfig} */\nmodule.exports = {\n  testRunner: {\n    $0: 'jest',\n    args: {\n      config: 'e2e/jest.config.js',\n      _: ['e2e']\n    },\n// highlight-start\n    jest: {\n      setupTimeout: 120000,\n      reportSpecs: false,\n      reportWorkerAssign: false,\n    },\n// highlight-end\n  },\n  // \u2026\n};\n")),(0,i.kt)("p",null,"If you have some customizations beyond that, make sure to remove the boilerplate code:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="e2e/environment.js"',title:'"e2e/environment.js"'},"// highlight-next-line\nconst { DetoxCircusEnvironment } = require('detox/runners/jest');\n\nclass CustomDetoxEnvironment extends DetoxCircusEnvironment {\n  constructor(config, context) {\n    super(config, context);\n\n    // leave your custom code\n  }\n}\n\nmodule.exports = CustomDetoxEnvironment;\n")),(0,i.kt)("p",null,"Pay attention that the import has been changed to ",(0,i.kt)("inlineCode",{parentName:"p"},"detox/runners/jest")," (previously it was ",(0,i.kt)("inlineCode",{parentName:"p"},"detox/runners/jest-circus"),"),\nand the reporters (",(0,i.kt)("inlineCode",{parentName:"p"},"SpecReporter"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"WorkerAssignReporter"),") are no longer exported. You can continue using\n",(0,i.kt)("inlineCode",{parentName:"p"},"this.initTimeout")," if you rename it there to ",(0,i.kt)("inlineCode",{parentName:"p"},"this.setupTimeout"),", but you can also delegate that to Detox config like shown earlier."),(0,i.kt)("h3",{id:"new-jest-config"},"New Jest config"),(0,i.kt)("p",null,"Let's examine ",(0,i.kt)("strong",{parentName:"p"},"the old configs")," first to see what needs to be removed or changed:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'showLineNumbers title="e2e/jest.config.js"',showLineNumbers:!0,title:'"e2e/jest.config.js"'},"module.exports = {\n  maxWorkers: 1,\n  testEnvironment: './environment',\n  testRunner: 'jest-circus/runner',\n  testTimeout: 120000,\n  testRegex: '\\\\.e2e\\\\.js$',\n  reporters: ['detox/runners/jest/streamlineReporter'],\n  verbose: true\n};\n")),(0,i.kt)("p",null,"See comments line by line:"),(0,i.kt)("p",null,"1","."," As a recommendation, switch to CommonJS (",(0,i.kt)("inlineCode",{parentName:"p"},"module.exports = {}"),") instead of JSON, if you haven\u2019t done that already."),(0,i.kt)("p",null,"2","."," If you don\u2019t have ",(0,i.kt)("inlineCode",{parentName:"p"},"maxWorkers: 1")," configured, please add it."),(0,i.kt)("p",null,"3","."," If you removed your test environment in the previous step, ",(0,i.kt)("inlineCode",{parentName:"p"},"testEnvironment")," property."),(0,i.kt)("p",null,"4","."," Remove ",(0,i.kt)("inlineCode",{parentName:"p"},"testRunner")," since it is already ",(0,i.kt)("inlineCode",{parentName:"p"},"jest-circus")," by default in Jest 27.x and higher."),(0,i.kt)("p",null,"5","."," You need a long ",(0,i.kt)("inlineCode",{parentName:"p"},"testTimeout")," value, because usually end-to-end tests cannot complete in 5 seconds, which is\nJest's default timeout value. We suggest 120 seconds by default, but you can fine-tine it."),(0,i.kt)("p",null,"6","."," We recommend to use ",(0,i.kt)("inlineCode",{parentName:"p"},"rootDir")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"testMatch")," instead of ",(0,i.kt)("inlineCode",{parentName:"p"},"testRegex"),", like this (assuming your Jest config is\nin ",(0,i.kt)("inlineCode",{parentName:"p"},"e2e")," folder of your project, together with the Detox test files):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-diff"},"-  testRegex: '',\n+  rootDir: '..',\n+  testMatch: ['<rootDir>/e2e/**/*.test.js'],\n")),(0,i.kt)("p",null,"7","."," Remove that ",(0,i.kt)("inlineCode",{parentName:"p"},"streamlineReporter"),". You\u2019ll be adding a new reporter in a second."),(0,i.kt)("p",null,"8","."," You need to set ",(0,i.kt)("inlineCode",{parentName:"p"},"verbose: true")," to disable log batching. In other words, Jest will be printing\nlogs with a significant delay, which is just inconvenient and annoying when you need\nto know what exactly is happening right now."),(0,i.kt)("p",null,"Now, let's take a look at ",(0,i.kt)("strong",{parentName:"p"},"the new config")," and the required additions:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'showLineNumbers title="e2e/jest.config.js"',showLineNumbers:!0,title:'"e2e/jest.config.js"'},"module.exports = {\n  maxWorkers: 1,\n  testTimeout: 120000,\n  verbose: true,\n// highlight-start\n  reporters: ['detox/runners/jest/reporter'],\n  globalSetup: 'detox/runners/jest/globalSetup',\n  globalTeardown: 'detox/runners/jest/globalTeardown',\n  testEnvironment: 'detox/runners/jest/testEnvironment',\n// highlight-end\n};\n")),(0,i.kt)("p",null,"Let's focus on lines 5-8:"),(0,i.kt)("ol",{start:5},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Add the new Detox reporter as the first one to your existing ",(0,i.kt)("inlineCode",{parentName:"p"},"reporters: [...]")," array or create that property\nlike we show. It is a reserved reporter for Detox core logic, so it does not affect your logs or any other output \u2013\njust make sure you have it.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Register ",(0,i.kt)("inlineCode",{parentName:"p"},"globalSetup")," shipped with Detox. If you have your own ",(0,i.kt)("inlineCode",{parentName:"p"},"globalSetup"),", then call both in a wrapper function:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = async () => {\n   await require('detox/runners/jest/index').globalSetup();\n   await yourGlobalSetupFunction();\n};\n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Register ",(0,i.kt)("inlineCode",{parentName:"p"},"globalTeardown")," shipped with Detox. If you have your own ",(0,i.kt)("inlineCode",{parentName:"p"},"globalTeardown"),", then you should wrap it\nwith ",(0,i.kt)("inlineCode",{parentName:"p"},"try-finally")," and call the teardown of Detox too:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = async () => {\n  try {\n    await yourGlobalTeardownFunction();\n  } finally {\n    await require('detox/runners/jest/index').globalTeardown();\n  }\n};\n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"If you already have removed your custom test environment, please switch to the default test environment shipped\nwith Detox like shown in the example. Otherwise, stay with your custom test environment but make sure to migrate it\nas was described earlier."))),(0,i.kt)("h3",{id:"stop-using-timeline-artifacts"},"Stop using timeline artifacts"),(0,i.kt)("p",null,"If you have been using ",(0,i.kt)("inlineCode",{parentName:"p"},"--record-timeline all")," CLI option or had timeline artifact configured in your config,"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-diff"}," {\n   artifacts: {\n     plugins: {\n       logs: 'all',\n       screenshot: 'failing',\n-      timeline: 'all',\n     }\n   }\n }\n")),(0,i.kt)("p",null,"please remove it from your configs and scripts. Timeline artifacts have been merged with log artifacts, so if\nyou need to have ",(0,i.kt)("inlineCode",{parentName:"p"},"detox.trace.json")," \u2013 just don\u2019t turn off your logs, and you\u2019ll get it."),(0,i.kt)("h3",{id:"updating-command-line-scripts"},"Updating command-line scripts"),(0,i.kt)("p",null,"Check your Detox scripts whether they had command-line arguments such as:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"detox test \u2026 -o path/to/jest.config \u2026\ndetox test \u2026 --runner-config path/to/jest.config \u2026\ndetox test \u2026 --workers 3 \u2026\n")),(0,i.kt)("p",null,"Detox became agnostic about third-party test runner arguments, and now you need to forward those arguments directly\nto your test runner (i.e. Jest):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"detox test \u2026 --config path/to/jest.config \u2026\ndetox test \u2026 --maxWorkers 3 \u2026\n")),(0,i.kt)("p",null,"You\u2019ll be able to tell that you\u2019ve run into a situation like this if you see error messages like:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-plain",metastring:"text",text:!0},'\u25cf Unrecognized CLI Parameter:\n\n  Unrecognized option "workers".\n\n  CLI Options Documentation:\n  https://jestjs.io/docs/cli\n')),(0,i.kt)("h3",{id:"revisit-environment-variables"},"Revisit environment variables"),(0,i.kt)("p",null,"If you\u2019re relying somewhere in your code on things like ",(0,i.kt)("inlineCode",{parentName:"p"},"process.env.DETOX_CONFIGURATION")," or any other that starts from ",(0,i.kt)("inlineCode",{parentName:"p"},"DETOX_"),", as a matter of a workaround, you can turn on ",(0,i.kt)("inlineCode",{parentName:"p"},"testRunner.forwardEnv")," in your Detox config:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title=".detoxrc.js"',title:'".detoxrc.js"'},"/** @type {Detox.DetoxConfig} */\nmodule.exports = {\n  testRunner: {\n    args: {\n      $0: 'jest',\n    },\n    // highlight-next-line\n    forwardEnv: true,\n  },\n  devices: { /* ... */ },\n  apps: { /* ... */ },\n  configurations: { /* ... */ },\n};\n")),(0,i.kt)("p",null,"That should solve temporarily the issue with missing environment variables, but this is\nnot the best solution overall. The better fix for that would be switch to using Detox\nInternals API."),(0,i.kt)("p",null,"For example, you were determining the number of workers depending on your configuration:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="e2e/jest.config.js"',title:'"e2e/jest.config.js"'},"module.exports = {\n  maxWorkers: process.env.CI\n    ? (`${process.env.DETOX_CONFIGURATION}`.startsWith('ios.') ? 3 : 2)\n    : 1,\n    globalSetup: '...',\n    globalTeardown: '...',\n    // ... and so on ...\n};\n")),(0,i.kt)("p",null,"That would translate to a cleaner code in Detox 20:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="e2e/jest.config.js"',title:'"e2e/jest.config.js"'},"const { resolveConfig } = require('detox/internals');\n\nmodule.exports = async () => {\n  const { device } = await resolveConfig();\n\n  return {\n    maxWorkers: process.env.CI ? (device.type === 'ios.simulator' ? 3 : 2) : 1,\n    globalSetup: '...',\n    globalTeardown: '...',\n    // ... and so on ...\n  };\n};\n")),(0,i.kt)("p",null,"The hard part is over now, congratulations on finishing the migration!\nStay tuned for the upcoming minor releases leveraging the recent architectural changes in Detox."),(0,i.kt)("h2",{id:"192"},"19.2"),(0,i.kt)("p",null,"The release has a ",(0,i.kt)("strong",{parentName:"p"},"developer experience")," improvement \u2013 ",(0,i.kt)("em",{parentName:"p"},"Detect pending in-flight requests")," (",(0,i.kt)("a",{parentName:"p",href:"https://github.com/wix/Detox/issues/3003"},"#3003"),", ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/jonathanmos"},(0,i.kt)("strong",{parentName:"a"},"@jonathanmos")),").\nThe feature adds extra logic that prevents forgotten ",(0,i.kt)("inlineCode",{parentName:"p"},"await")," statements on asynchronous Detox APIs. That\u2019s why you might see a new error like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-plain",metastring:"text",text:!0},'FAILED\nDetoxRuntimeError: The pending request \\#246 ("invoke") has been rejected due to the following error:\n\nDetox has detected multiple interactions taking place simultaneously. Have you forgotten to apply an await over one of the Detox actions in your test code?\n')),(0,i.kt)("p",null,"That should help you find forgotten ",(0,i.kt)("inlineCode",{parentName:"p"},"await"),"s in your code that are a potential reason for flakiness in E2E tests.\nYou\u2019ll need to find those places and apply trivial fixes like shown below:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-diff"},"   await screenDriver.performSomeAction();\n-  expect(screenDriver.get.myElement()).toBeNotVisible();\n+  await expect(screenDriver.get.myElement()).toBeNotVisible();\n")),(0,i.kt)("h2",{id:"190"},"19.0"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Version 19 is not really a breaking change!")),(0,i.kt)("p",null,"We decided to bump Detox into a major version release, nonetheless, because it is breaking for projects that sport ",(0,i.kt)("a",{parentName:"p",href:"/Detox/docs/next/articles/third-party-drivers"},"custom Detox drivers"),", such as ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/ouihealth/detox-puppeteer"},(0,i.kt)("inlineCode",{parentName:"a"},"detox-puppeteer")),"."),(0,i.kt)("p",null,"If you are a maintainer of such a project, and you wish to upgrade your Detox dependency to 19 (kudos! \ud83d\udc4f),  follow this step-by-step migration guide; You can refer to ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/ouihealth/detox-puppeteer/pull/13"},"this pull-request"),", which does that for the  ",(0,i.kt)("inlineCode",{parentName:"p"},"detox-puppeteer")," project."),(0,i.kt)("h3",{id:"migrating-custom-drivers"},"Migrating Custom Drivers"),(0,i.kt)("p",null,"The core of the change is that Detox' drivers framework is ",(0,i.kt)("strong",{parentName:"p"},"no longer a single monolith"),", responsible for everything platform-specific. Rather, it\u2019s been broken down to these subresponsibilies:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Allocation: The process of launching / selecting a device over which the tests would run in the current execution."),(0,i.kt)("li",{parentName:"ul"},"Validation: Execution environment checkups."),(0,i.kt)("li",{parentName:"ul"},"Artifacts: Platform-based selection of build-artifacts implementation (e.g. screenshots)."),(0,i.kt)("li",{parentName:"ul"},"Runtime")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"You can find a visual explanation, ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/wix/Detox/files/7338121/pre-multiapps-rfc.pdf"},"here"),".")),(0,i.kt)("p",null,"In addition, the runtime driver is no longer state-less \u2013 basically, allowing implementation to hold any state that is required in identifying and managing the associated device."),(0,i.kt)("h4",{id:"how-to-migrate"},"How to migrate"),(0,i.kt)("p",null,"Everything here will be based on the changes made in the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/ouihealth/detox-puppeteer"},(0,i.kt)("inlineCode",{parentName:"a"},"detox-puppeteer")," example")," - names included (please don\u2019t use them as-is in your own implementation!)."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Allocation:")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Create a new class, called ",(0,i.kt)("inlineCode",{parentName:"li"},"PuppeteerDeviceAllocation")," (change name to something that would make sense in your project)."),(0,i.kt)("li",{parentName:"ul"},"Move everything currently in ",(0,i.kt)("inlineCode",{parentName:"li"},"PuppeteerDriver.acquireFreeDevice()")," and ",(0,i.kt)("inlineCode",{parentName:"li"},".shutdown()")," onto ",(0,i.kt)("inlineCode",{parentName:"li"},"PuppeteerDeviceAllocation.allocate()")," and ",(0,i.kt)("inlineCode",{parentName:"li"},".free()"),", respectively."),(0,i.kt)("li",{parentName:"ul"},"Create a POJO class called ",(0,i.kt)("inlineCode",{parentName:"li"},"PuppeteerAllocCookie"),". This class should hold anything that would later be required in order to specify the specifically associated device (example: ",(0,i.kt)("inlineCode",{parentName:"li"},"UDID")," for iOS simulators, ",(0,i.kt)("inlineCode",{parentName:"li"},"adb")," names for Android devices)."),(0,i.kt)("li",{parentName:"ul"},"Make ",(0,i.kt)("inlineCode",{parentName:"li"},".allocate()")," return an instance of your cookie class. Puppeteer example: ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/ouihealth/detox-puppeteer/pull/13/files#diff-818f6c5309fffe5c710e542216ffdb55f468fd2f8035feb0b0c917785489aca7R841"},"here"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Delete ",(0,i.kt)("inlineCode",{parentName:"strong"},"PuppeteerDriver.acquireFreeDevice()")," and ",(0,i.kt)("inlineCode",{parentName:"strong"},"PuppeteerDriver.shutdown()"),"."))),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"For a precise class c'tor and method signatures, see ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/ouihealth/detox-puppeteer/pull/13/files#diff-818f6c5309fffe5c710e542216ffdb55f468fd2f8035feb0b0c917785489aca7R830"},"here"),".")),(0,i.kt)("p",null,"Add the new allocation class to the ",(0,i.kt)("inlineCode",{parentName:"p"},"module.exports")," list, under the name: ",(0,i.kt)("inlineCode",{parentName:"p"},"DeviceAllocationDriverClass"),"."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Validation:")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"If you have any validations implemented in ",(0,i.kt)("inlineCode",{parentName:"li"},"PuppeteerDriver.prepare()"),", create a class called ",(0,i.kt)("inlineCode",{parentName:"li"},"PuppeteerEnvironmentValidator"),"."),(0,i.kt)("li",{parentName:"ul"},"Move anything inside ",(0,i.kt)("inlineCode",{parentName:"li"},"PuppeteerDriver.prepare()")," to ",(0,i.kt)("inlineCode",{parentName:"li"},"PuppeteerEnvironmentValidator.validate()"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Delete ",(0,i.kt)("inlineCode",{parentName:"strong"},"PupeteerDriver.prepare()"),"."))),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"For a precise class c'tor and method signatures, see ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/ouihealth/detox-puppeteer/pull/13/files#diff-818f6c5309fffe5c710e542216ffdb55f468fd2f8035feb0b0c917785489aca7R798"},"here"),".")),(0,i.kt)("p",null,"Add the new (optional) class to the ",(0,i.kt)("inlineCode",{parentName:"p"},"module.exports")," list, under the name: ",(0,i.kt)("inlineCode",{parentName:"p"},"EnvironmentValidatorClass"),"."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Artifacts:")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Move your implementation of ",(0,i.kt)("inlineCode",{parentName:"li"},"PuppeteerDriver.declareArtifactPlugins()")," to the same method in a new class, called ",(0,i.kt)("inlineCode",{parentName:"li"},"PuppeteerArtifactPluginsProvider.declareArtifactPlugins()")," (change name to something that would make sense in your project).")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"There are no changes in method signature in this case.")),(0,i.kt)("p",null,"Add the new class to the ",(0,i.kt)("inlineCode",{parentName:"p"},"module.exports")," list, under the name: ",(0,i.kt)("inlineCode",{parentName:"p"},"ArtifactPluginsProviderClass"),"."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Runtime:")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Optionally rename your class from ",(0,i.kt)("inlineCode",{parentName:"li"},"PuppeteerDriver")," to ",(0,i.kt)("inlineCode",{parentName:"li"},"PuppeteerRuntimeDriver"),"."),(0,i.kt)("li",{parentName:"ul"},"In the methods remaining in the class accepting the ",(0,i.kt)("inlineCode",{parentName:"li"},"deviceId")," arg: ",(0,i.kt)("strong",{parentName:"li"},"remove the ",(0,i.kt)("inlineCode",{parentName:"strong"},"deviceId")," arg entirely"),". This might break your implementation - don\u2019t worry, continue reading."),(0,i.kt)("li",{parentName:"ul"},"If applicable, change the signature of the class' c'tor to accept the cookie as its 2nd argument (instance previously allocated in ",(0,i.kt)("inlineCode",{parentName:"li"},"PuppeteerAllocationDriver.allocate()"),"). Save data from the cookie as part of the driver\u2019s state, in order to unbreak your implementation, following the previous step."),(0,i.kt)("li",{parentName:"ul"},"Add two methods: ",(0,i.kt)("inlineCode",{parentName:"li"},"getExternalId()")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"getDeviceName()"),". Implement them such that they would comply with the ",(0,i.kt)("inlineCode",{parentName:"li"},"device.id")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"device.name")," ",(0,i.kt)("a",{parentName:"li",href:"/Detox/docs/next/api/device"},"API contracts"),", respectively.")),(0,i.kt)("p",null,"Export the runtime driver class in the ",(0,i.kt)("inlineCode",{parentName:"p"},"module.exports")," list as ",(0,i.kt)("inlineCode",{parentName:"p"},"RuntimeDriverClass"),", ",(0,i.kt)("strong",{parentName:"p"},"instead of ",(0,i.kt)("inlineCode",{parentName:"strong"},"DriverClass"),".")),(0,i.kt)("h4",{id:"troubleshooting"},"Troubleshooting"),(0,i.kt)("p",null,"For issue related to these migrations, approach us by ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/wix/Detox/issues/new/choose"},"submitting an issue on GitHub"),". Please apply the ",(0,i.kt)("inlineCode",{parentName:"p"},"Detox19")," label."),(0,i.kt)("h2",{id:"1860"},"18.6.0"),(0,i.kt)("p",null,"Detox has normalized the configuration format, so that along with the combined ",(0,i.kt)("inlineCode",{parentName:"p"},"configurations")," object you now can define your ",(0,i.kt)("inlineCode",{parentName:"p"},"devices")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"apps")," separately.\nPlease refer to the ",(0,i.kt)("a",{parentName:"p",href:"/Detox/docs/next/config/overview"},"configuration doc")," to obtain more details.\nThis change is backward-compatible, although the new format is now the recommended option."),(0,i.kt)("h2",{id:"180"},"18.0"),(0,i.kt)("p",null,"Detox now uses a custom synchronization system on iOS, ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/wix/DetoxSync"},"developed in-house"),"; this is the second step in phasing out our Earl Grey usage. We have tested this system extensively internally, and are confident that it should work as expected. There are no known limitations with the new system."),(0,i.kt)("p",null,"If you are seeing issues with the new sync system, please open an issue."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Breaking:")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"iOS.")," Detox now requires iOS 13.0 and above iOS simulator runtimes, and iOS 12.x and below are no longer supported. This does not require that you drop support for iOS 12.x in your apps, just that tests will no longer work on iOS 12 and below. Please make sure your tests are running on iOS 13 or above"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"JS.")," \u26a0\ufe0f Detox no longer launches the app automatically (even if asked to do so in configuration) \u2014 you have to launch your app explicitly:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-diff"},"+  beforeAll(async () => {\n+    await device.launchApp();\n+  });\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"JS (jest-circus).")," The ",(0,i.kt)("inlineCode",{parentName:"li"},"DetoxCircusEnvironment")," provided from ",(0,i.kt)("inlineCode",{parentName:"li"},"detox/runners/jest-circus")," package now requires two arguments in its constructor, so you have to update your descendant class signature:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-diff"},"class CustomDetoxEnvironment extends DetoxCircusEnvironment {\n-  constructor(config) {\n-    super(config);\n+  constructor(config, context) {\n+    super(config, context);\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"JS (iOS).")," ",(0,i.kt)("inlineCode",{parentName:"li"},"device.launchApp({ launchArgs: { ... })")," argument escaping has been improved. If you use complex launch args such as regular expressions, make sure you remove manual escaping from now on to avoid erroneous double escaping, e.g.:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-diff"}," await device.launchApp({\n   launchArgs: {\n-    detoxURLBlacklistRegex: '(\\\\\".*example.com/some-url/.*\\\\\")' }`,\n+    detoxURLBlacklistRegex: '(\".*example.com/some-url/.*\")' }`,\n   },\n });\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"JS (internal).")," There is a breaking change for people writing custom Detox integrations. Environment variable naming schema has changed \u2013 now Detox uses prefix to distinguish its own environment variables (usually passed from ",(0,i.kt)("inlineCode",{parentName:"li"},"detox test")," CLI), e.g.: ",(0,i.kt)("inlineCode",{parentName:"li"},"recordLogs=all")," becomes ",(0,i.kt)("inlineCode",{parentName:"li"},"DETOX_RECORD_LOGS=all"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"loglevel=trace")," becomes ",(0,i.kt)("inlineCode",{parentName:"li"},"DETOX_LOGLEVEL=trace"),", and so on.")),(0,i.kt)("h2",{id:"1752"},"17.5.2"),(0,i.kt)("p",null,"Fixes the issue from ",(0,i.kt)("strong",{parentName:"p"},"17.4.7")," (see below) - now the migration guide for ",(0,i.kt)("strong",{parentName:"p"},"17.4.7")," can be safely ignored."),(0,i.kt)("h2",{id:"1747"},"17.4.7"),(0,i.kt)("p",null,"This release was not meant to be breaking in any sense, but unfortunately there are two minor caveats that leaked in."),(0,i.kt)("h3",{id:"jest-cli"},(0,i.kt)("inlineCode",{parentName:"h3"},"jest-cli")),(0,i.kt)("p",null,"From now on, Detox explicitly depends on ",(0,i.kt)("inlineCode",{parentName:"p"},"jest-cli")," package (marked as a peer dependency), that\u2019s why if you see an error like the one below:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-plain",metastring:"text",text:!0},"Cannot find module 'jest-cli/build/cli/args'\n")),(0,i.kt)("p",null,(0,i.kt)("del",{parentName:"p"},"You should add ",(0,i.kt)("inlineCode",{parentName:"del"},"jest-cli")," to your ",(0,i.kt)("inlineCode",{parentName:"del"},"package.json"),"\u2019s ",(0,i.kt)("inlineCode",{parentName:"del"},"devDependencies")," and rerun ",(0,i.kt)("inlineCode",{parentName:"del"},"npm install"),", e.g.:")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"UPD"),": since ",(0,i.kt)("inlineCode",{parentName:"p"},"detox@17.5.2")," you can ignore this advice. The problem should go away ",(0,i.kt)("strong",{parentName:"p"},"without")," these edits:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-diff"},' "devDependencies": {\n   "jest": "26.x.x",\n+  "jest-cli": "26.x.x",\n')),(0,i.kt)("h3",{id:"detox-cli"},(0,i.kt)("inlineCode",{parentName:"h3"},"detox-cli")),(0,i.kt)("p",null,"If you were using ",(0,i.kt)("inlineCode",{parentName:"p"},"detox-cli")," global package, make sure to upgrade it before proceeding to ",(0,i.kt)("inlineCode",{parentName:"p"},"detox@17.4.7"),"."),(0,i.kt)(o.Z,{groupId:"npm2yarn",mdxType:"Tabs"},(0,i.kt)(r.Z,{value:"npm",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"npm install detox-cli --global\n"))),(0,i.kt)(r.Z,{value:"yarn",label:"Yarn",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"yarn global add detox-cli\n")))),(0,i.kt)("p",null,"If you have an older version of ",(0,i.kt)("inlineCode",{parentName:"p"},"detox-cli"),", then you might see the following error on an attempt to run  ",(0,i.kt)("inlineCode",{parentName:"p"},"detox test <...args>"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-plain",metastring:"text",text:!0},"'jest' is not recognized as an internal or external command,\noperable program or batch file.\ndetox[43764] ERROR: [cli.js] Error: Command failed: jest --config e2e/config.json --testNamePattern \"^((?!:android:).)*$\" --maxWorkers 1 e2e\n")),(0,i.kt)("h2",{id:"1730"},"17.3.0"),(0,i.kt)("p",null,"In the context of introducing the element screenshots feature (",(0,i.kt)("a",{parentName:"p",href:"https://github.com/wix/Detox/issues/2012"},"#2012"),"), we decided to slightly change the contract between Detox and externally-implemented ",(0,i.kt)("em",{parentName:"p"},"drivers"),". These should be modified according to the follow diff-snippet:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-diff"},"class Expect {\n-  constructor(invocationManager) {\n+  constructor({ invocationManager }) {\n     this._invocationManager = invocationManager;\n  }\n}\n\nclass PluginDriver {\n  constructor() {\n-    this.matchers = new Expect(new invocationManager());\n  }\n}\n\n-module.exports = PluginDriver;\n+module.exports = {\n+  DriverClass: PluginDriver,\n+  ExpectClass: Expect,\n+}\n")),(0,i.kt)("h2",{id:"1700"},"17.0.0"),(0,i.kt)("p",null,"Detox for iOS now uses an entirely new, custom-built matcher, action and expectation infrastructure. This is the first step in our roadmap of removing Earl Grey as a dependency."),(0,i.kt)("p",null,"While the new system has been designed to be as compatible as possible with the existing system, some changes we made to existing APIs that may or may not require your attention."),(0,i.kt)("h3",{id:"new-api"},"New API"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"pinch()"),"\u2014new API for pinching elements, replacing the deprecated ",(0,i.kt)("inlineCode",{parentName:"li"},"pinchWithAngle()")," (iOS)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"getAttributes()"),"\u2014new API for obtaining element properties (iOS)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"not"),"\u2014new API for inverting expectation logic (iOS, Android)")),(0,i.kt)("h3",{id:"modified-api-potentially-breaking-changes"},"Modified API (",(0,i.kt)("strong",{parentName:"h3"},"Potentially Breaking Changes"),")"),(0,i.kt)("p",null,"The following APIs have changed and require attention"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"by.text()"),"\u2014matching elements by text actually uses the element\u2019s text value instead of using the accessibility label (iOS)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"by.traits()"),"\u2014the supported trait values have changed (iOS)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"atIndex()"),"\u2014matched elements are now sorted by x and y axes to allow for stability between tests; indices will most likely change after upgrading to this version of Detox (iOS)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"tap()"),"\u2014this method now accepts an optional point to tap (iOS, Android)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"setColumnToValue()"),"\u2014this method no longer supports date pickers; use ",(0,i.kt)("inlineCode",{parentName:"li"},"setDatePickerDate()")," to change picker dates (iOS)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"setDatePickerDate()"),"\u2014in addition to normal date formats, a new special case is introduced for ISO 8601 formatted date strings: ",(0,i.kt)("inlineCode",{parentName:"li"},'"ISO8601"')," (iOS)")),(0,i.kt)("h3",{id:"deprecated-api"},"Deprecated API"),(0,i.kt)("p",null,"The following APIs have been deprecated, but is still available"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"tapAtPoint()"),"\u2014the API has been consolidated with ",(0,i.kt)("inlineCode",{parentName:"li"},"tap(point)")," (iOS, Android)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"pinchWithAngle()"),"\u2014this API has been replaced with ",(0,i.kt)("inlineCode",{parentName:"li"},"pinch()")," (iOS)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"toBeNotVisible()"),"\u2014deprecated in favor of ",(0,i.kt)("inlineCode",{parentName:"li"},"not.toBeVisible()")," (iOS, Android)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"toNotExist()"),"\u2014deprecated in favor of ",(0,i.kt)("inlineCode",{parentName:"li"},"not.toExist()")," (iOS, Android)")),(0,i.kt)("p",null,"Make sure to read the API reference for ",(0,i.kt)("a",{parentName:"p",href:"/Detox/docs/next/api/matchers"},"matchers"),", ",(0,i.kt)("a",{parentName:"p",href:"/Detox/docs/next/api/actions"},"actions")," and ",(0,i.kt)("a",{parentName:"p",href:"/Detox/docs/next/api/expect"},"expectations"),"."),(0,i.kt)("p",null,"If you see unexpected results, make sure to open an issue."),(0,i.kt)("h2",{id:"1600"},"16.0.0"),(0,i.kt)("p",null,"Detox now comes as a prebuilt framework on iOS, thus lowering npm install times and saving some build issues that happen due to unexpected Xcode setups."),(0,i.kt)("p",null,"To support this, Detox needs Swift 5 support, so the iOS requirements have changed slightly:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Xcode"),": 10.2 or higher",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"iOS Simulator Runtime"),": iOS 12.2 or higher")))),(0,i.kt)("p",null,"This does not require that your app require iOS 12.2, only that you build and run your app on Xcode 10.2 or above, and use an iOS 12.2 or above simulator."))}m.isMDXComponent=!0}}]);